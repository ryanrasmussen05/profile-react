import { Flight, FlightAwareFlight } from './types';

const BASE_URL = 'https://flightawareomahaflights-7vj4jmsdna-uc.a.run.app';

export async function fetchFlightData(): Promise<Flight[]> {
  const url = new URL(BASE_URL);
  const response = await fetch(url.toString());
  const data: FlightAwareFlight[] = await response.json();

  return data.map(toFlight);
}

function toFlight(flightAwareFlight: FlightAwareFlight): Flight {
  return {
    latitude: flightAwareFlight.last_position.latitude,
    longitude: flightAwareFlight.last_position.longitude,
    altitude: flightAwareFlight.last_position.altitude * 100, // hundreds of feet to feet
    heading: flightAwareFlight.last_position.heading,
    speed: Math.floor(flightAwareFlight.last_position.groundspeed * 1.15078), // knots to mph
    flightNumber: flightAwareFlight.flightNumber ?? undefined,
    aircraft: flightAwareFlight.aircraft_type,
    airline: flightAwareFlight.ident_icao,
    departureAirport: flightAwareFlight.origin?.code_iata || flightAwareFlight.origin?.code_icao,
    departureAirportDetails: flightAwareFlight.origin ?? undefined,
    destinationAirport: flightAwareFlight.destination?.code_iata || flightAwareFlight.destination?.code_icao,
    destinationAirportDetails: flightAwareFlight.destination ?? undefined,
    tailNumber: flightAwareFlight.registration ?? undefined,
    waypoints: flightAwareFlight.waypoints,
  };
}

// const mockResponse: FlightAwareFlight[] = [
//   {
//     ident: 'N968SP',
//     ident_icao: null,
//     ident_iata: null,
//     fa_flight_id: 'N968SP-1710181912-sw-630p',
//     actual_off: '2024-03-11T20:25:09Z',
//     actual_on: null,
//     foresight_predictions_available: true,
//     predicted_out: null,
//     predicted_off: null,
//     predicted_on: null,
//     predicted_in: null,
//     predicted_out_source: null,
//     predicted_off_source: null,
//     predicted_on_source: null,
//     predicted_in_source: null,
//     origin: {
//       code: 'KMKC',
//       code_icao: 'KMKC',
//       code_iata: 'MKC',
//       code_lid: 'MKC',
//       timezone: 'America/Chicago',
//       name: 'Wheeler Downtown',
//       city: 'Kansas City',
//       airport_info_url: '/airports/KMKC',
//     },
//     destination: {
//       code: 'KCBF',
//       code_icao: 'KCBF',
//       code_iata: null,
//       code_lid: 'CBF',
//       timezone: 'America/Chicago',
//       name: 'Council Bluffs Muni',
//       city: 'Council Bluffs',
//       airport_info_url: '/airports/KCBF',
//     },
//     waypoints: [
//       39.12, -94.59, 39.23, -94.65, 39.23, -94.65, 39.27, -94.67, 39.3, -94.69, 39.19, -94.75, 39.13, -94.78, 39.28,
//       -94.98, 39.41, -95.03, 39.59, -95.11, 39.83, -95.2, 40.19, -95.34, 40.32, -95.39, 40.69, -95.54, 41.03, -95.68,
//       41.11, -95.71, 41.17, -95.74, 41.23, -95.75, 41.26, -95.76,
//     ],
//     first_position_time: '2024-03-11T20:16:56Z',
//     last_position: {
//       fa_flight_id: 'N968SP-1710181912-sw-630p',
//       altitude: 30,
//       altitude_change: 'D',
//       groundspeed: 124,
//       heading: 342,
//       latitude: 41.00815,
//       longitude: -95.67519,
//       timestamp: '2024-03-11T21:35:56Z',
//       update_type: 'A',
//     },
//     bounding_box: [41.00815, -95.67519, 39.11165, -94.59131],
//     ident_prefix: null,
//     aircraft_type: 'C172',
//     registration: 'N968SP',
//     flightNumber: null,
//   },
//   {
//     ident: 'FDJ268',
//     ident_icao: 'FDJ268',
//     ident_iata: null,
//     fa_flight_id: 'FDJ268-1710180127-sw-1516p',
//     actual_off: '2024-03-11T20:12:32Z',
//     actual_on: null,
//     foresight_predictions_available: true,
//     predicted_out: null,
//     predicted_off: null,
//     predicted_on: null,
//     predicted_in: null,
//     predicted_out_source: null,
//     predicted_off_source: null,
//     predicted_on_source: null,
//     predicted_in_source: null,
//     origin: {
//       code: 'KASE',
//       code_icao: 'KASE',
//       code_iata: 'ASE',
//       code_lid: 'ASE',
//       timezone: 'America/Denver',
//       name: 'Aspen-Pitkin County',
//       city: 'Aspen',
//       airport_info_url: '/airports/KASE',
//     },
//     destination: {
//       code: 'KOMA',
//       code_icao: 'KOMA',
//       code_iata: 'OMA',
//       code_lid: 'OMA',
//       timezone: 'America/Chicago',
//       name: 'Eppley Airfield',
//       city: 'Omaha',
//       airport_info_url: '/airports/KOMA',
//     },
//     waypoints: [
//       39.22, -106.87, 39.26, -106.93, 39.31, -107.02, 39.37, -107.01, 39.4, -106.88, 39.42, -107, 39.43, -106.95, 39.46,
//       -106.82, 39.48, -106.75, 39.51, -106.62, 39.54, -106.48, 39.55, -106.42, 39.55, -106.42, 39.58, -106.27, 39.6,
//       -106.2, 39.63, -106.04, 39.66, -105.9, 39.68, -105.8, 39.73, -105.58, 39.74, -105.52, 39.82, -105.14, 39.82,
//       -105.12, 39.85, -104.97, 40.1, -103.69, 40.2, -103.18, 40.23, -103.01, 40.28, -102.72, 40.33, -102.47, 40.37,
//       -102.25, 40.37, -102.24, 40.88, -99.05, 40.91, -98.84, 40.98, -98.35, 40.98, -98.31, 41.04, -98.11, 41.25, -97.31,
//       41.28, -97.19, 41.3, -97.11, 41.37, -96.85, 41.36, -96.8, 41.34, -96.69, 41.29, -96.43, 41.28, -96.36, 41.26,
//       -96.27, 41.28, -96.14, 41.29, -96.03, 41.3, -95.92, 41.3, -95.89,
//     ],
//     first_position_time: '2024-03-11T20:12:32Z',
//     last_position: {
//       fa_flight_id: 'FDJ268-1710180127-sw-1516p',
//       altitude: 55,
//       altitude_change: 'D',
//       groundspeed: 303,
//       heading: 81,
//       latitude: 41.39425,
//       longitude: -96.32991,
//       timestamp: '2024-03-11T21:35:58Z',
//       update_type: 'A',
//     },
//     bounding_box: [41.39425, -107.03854, 39.23367, -96.32991],
//     ident_prefix: null,
//     aircraft_type: 'EA50',
//     flightNumber: 'FDJ268',
//     registration: 'N268EM',
//   },
//   {
//     ident: 'UAL260',
//     ident_icao: 'UAL260',
//     ident_iata: 'UA260',
//     fa_flight_id: 'UAL260-1709979517-fa-1368p',
//     actual_off: '2024-03-11T18:42:22Z',
//     actual_on: null,
//     foresight_predictions_available: true,
//     predicted_out: null,
//     predicted_off: null,
//     predicted_on: null,
//     predicted_in: null,
//     predicted_out_source: null,
//     predicted_off_source: null,
//     predicted_on_source: null,
//     predicted_in_source: null,
//     origin: {
//       code: 'KBOS',
//       code_icao: 'KBOS',
//       code_iata: 'BOS',
//       code_lid: 'BOS',
//       timezone: 'America/New_York',
//       name: 'Boston Logan Intl',
//       city: 'Boston',
//       airport_info_url: '/airports/KBOS',
//     },
//     destination: {
//       code: 'KSFO',
//       code_icao: 'KSFO',
//       code_iata: 'SFO',
//       code_lid: 'SFO',
//       timezone: 'America/Los_Angeles',
//       name: "San Francisco Int'l",
//       city: 'San Francisco',
//       airport_info_url: '/airports/KSFO',
//     },
//     waypoints: [
//       42.36, -71.01, 42.46, -71.08, 42.47, -71.08, 42.48, -71.09, 42.52, -71.12, 42.52, -71.12, 42.54, -71.14, 42.57,
//       -71.16, 42.59, -71.17, 42.6, -71.18, 42.63, -71.2, 42.7, -71.26, 42.71, -71.29, 42.74, -71.52, 42.75, -71.56,
//       42.77, -71.68, 42.8, -71.89, 42.8, -71.89, 42.8, -71.95, 42.84, -72.18, 42.86, -72.36, 42.88, -72.46, 42.89,
//       -72.57, 42.99, -73.34, 43, -73.74, 43, -73.76, 43.01, -74.25, 43.03, -74.51, 43.03, -74.69, 43.06, -75.29, 43.06,
//       -75.29, 43.06, -75.53, 43.07, -75.76, 43.09, -76.69, 43.09, -76.76, 43.09, -76.84, 43.09, -76.96, 43.1, -77.24,
//       43.1, -79.03, 43.1, -79.04, 43.07, -81.1, 43.05, -81.75, 43.04, -81.93, 43.03, -82.38, 43.02, -82.41, 43.02,
//       -82.41, 42.97, -83.48, 42.97, -83.75, 42.95, -83.86, 42.9, -84.15, 42.83, -84.58, 42.81, -84.74, 42.76, -85,
//       42.73, -85.16, 42.64, -85.71, 42.59, -86, 42.41, -87, 42.22, -87.95, 42.12, -88.55, 42.07, -88.82, 41.95, -89.46,
//       41.85, -89.97, 41.6, -91.23, 41.52, -91.61, 41.43, -92.49, 41.35, -93.28, 41.32, -93.55, 41.19, -94.71, 41.17,
//       -94.83, 41.1, -95.42, 41.04, -95.87, 40.92, -96.74, 40.84, -97.56, 40.8, -97.97, 40.76, -98.37, 40.68, -99.05,
//       40.56, -100.12, 40.45, -100.92, 40.34, -102.05, 40.22, -103.18, 40.19, -103.47, 40.18, -103.5, 39.99, -105.08,
//       39.79, -106.53, 39.71, -107.22, 39.59, -108.27, 39.37, -109.97, 39.35, -110.1, 39.23, -110.93, 39.12, -111.72,
//       39.02, -112.38, 38.84, -113.47, 38.78, -113.85, 38.56, -115.09, 38.33, -116.33, 38.23, -116.8, 38.12, -117.27,
//       38.12, -117.27, 38, -117.77, 37.9, -118.76, 37.86, -119.1, 37.82, -119.42, 37.81, -119.53, 37.76, -119.9, 37.75,
//       -119.99, 37.74, -120.07, 37.7, -120.4, 37.7, -120.42, 37.69, -120.49, 37.67, -120.69, 37.66, -120.75, 37.66,
//       -120.78, 37.65, -120.83, 37.63, -120.96, 37.63, -121, 37.62, -121.08, 37.6, -121.18, 37.59, -121.26, 37.58,
//       -121.39, 37.58, -121.41, 37.55, -121.6, 37.55, -121.61, 37.55, -121.62, 37.53, -121.69, 37.51, -121.8, 37.51,
//       -121.81, 37.49, -121.88, 37.54, -122.08, 37.55, -122.09, 37.57, -122.18, 37.59, -122.28, 37.61, -122.33, 37.61,
//       -122.36, 37.62, -122.38,
//     ],
//     first_position_time: '2024-03-11T18:28:31Z',
//     last_position: {
//       fa_flight_id: 'UAL260-1709979517-fa-1368p',
//       altitude: 359,
//       altitude_change: '-',
//       groundspeed: 417,
//       heading: 260,
//       latitude: 41.04166,
//       longitude: -95.87201,
//       timestamp: '2024-03-11T21:36:12Z',
//       update_type: 'A',
//     },
//     bounding_box: [43.10262, -95.87201, 41.04166, -70.99252],
//     ident_prefix: null,
//     aircraft_type: 'B752',
//     flightNumber: 'UAL260',
//     registration: 'N67134',
//   },
//   {
//     ident: 'AMF1612',
//     ident_icao: 'AMF1612',
//     ident_iata: null,
//     fa_flight_id: 'AMF1612-1710192518-sw-512p',
//     actual_off: '2024-03-11T21:35:07Z',
//     actual_on: null,
//     foresight_predictions_available: false,
//     predicted_out: null,
//     predicted_off: null,
//     predicted_on: null,
//     predicted_in: null,
//     predicted_out_source: null,
//     predicted_off_source: null,
//     predicted_on_source: null,
//     predicted_in_source: null,
//     origin: {
//       code: 'KOMA',
//       code_icao: 'KOMA',
//       code_iata: 'OMA',
//       code_lid: 'OMA',
//       timezone: 'America/Chicago',
//       name: 'Eppley Airfield',
//       city: 'Omaha',
//       airport_info_url: '/airports/KOMA',
//     },
//     destination: {
//       code: 'KEAR',
//       code_icao: 'KEAR',
//       code_iata: 'EAR',
//       code_lid: 'EAR',
//       timezone: 'America/Chicago',
//       name: 'Kearney Rgnl',
//       city: 'Kearney',
//       airport_info_url: '/airports/KEAR',
//     },
//     waypoints: [
//       41.3, -95.89, 41.28, -96, 41.27, -96.1, 41.25, -96.23, 41.04, -97.38, 40.9, -98.13, 40.9, -98.13, 40.86, -98.35,
//       40.81, -98.61, 40.8, -98.62, 40.77, -98.8, 40.76, -98.84, 40.75, -98.87, 40.74, -98.94, 40.73, -99.01,
//     ],
//     first_position_time: '2024-03-11T21:30:52Z',
//     last_position: {
//       fa_flight_id: 'AMF1612-1710192518-sw-512p',
//       altitude: 52,
//       altitude_change: 'C',
//       groundspeed: 168,
//       heading: 261,
//       latitude: 41.257,
//       longitude: -95.98096,
//       timestamp: '2024-03-11T21:36:14Z',
//       update_type: 'A',
//     },
//     bounding_box: [41.31325, -95.98096, 41.257, -95.88966],
//     ident_prefix: null,
//     aircraft_type: 'B190',
//     flightNumber: 'AMF1612',
//     registration: 'N3052K',
//   },
//   {
//     ident: 'AWI6084',
//     ident_icao: 'AWI6084',
//     ident_iata: 'ZW6084',
//     fa_flight_id: 'AWI6084-1710016843-schedule-2413p',
//     actual_off: '2024-03-11T20:29:56Z',
//     actual_on: null,
//     foresight_predictions_available: true,
//     predicted_out: null,
//     predicted_off: null,
//     predicted_on: null,
//     predicted_in: null,
//     predicted_out_source: null,
//     predicted_off_source: null,
//     predicted_on_source: null,
//     predicted_in_source: null,
//     origin: {
//       code: 'KORD',
//       code_icao: 'KORD',
//       code_iata: 'ORD',
//       code_lid: 'ORD',
//       timezone: 'America/Chicago',
//       name: "Chicago O'Hare Intl",
//       city: 'Chicago',
//       airport_info_url: '/airports/KORD',
//     },
//     destination: {
//       code: 'KOMA',
//       code_icao: 'KOMA',
//       code_iata: 'OMA',
//       code_lid: 'OMA',
//       timezone: 'America/Chicago',
//       name: 'Eppley Airfield',
//       city: 'Omaha',
//       airport_info_url: '/airports/KOMA',
//     },
//     waypoints: [
//       41.98, -87.91, 41.97, -87.97, 41.97, -87.99, 41.97, -88.08, 41.97, -88.08, 41.96, -88.19, 41.96, -88.22, 41.94,
//       -88.45, 41.92, -88.67, 41.92, -88.74, 41.91, -88.79, 41.91, -88.81, 41.91, -88.82, 41.91, -88.9, 41.9, -89.11,
//       41.9, -89.21, 41.88, -89.39, 41.86, -89.57, 41.85, -89.72, 41.85, -89.73, 41.81, -90.16, 41.8, -90.33, 41.78,
//       -90.5, 41.7, -91.31, 41.52, -93, 41.47, -93.37, 41.46, -93.47, 41.46, -93.5, 41.45, -93.57, 41.44, -93.65, 41.45,
//       -93.86, 41.45, -93.94, 41.46, -94.12, 41.48, -94.34, 41.49, -94.59, 41.5, -94.92, 41.5, -94.93, 41.51, -95.13,
//       41.51, -95.15, 41.5, -95.18, 41.43, -95.42, 41.39, -95.59, 41.38, -95.63, 41.35, -95.74, 41.35, -95.74, 41.32,
//       -95.84, 41.41, -95.89, 41.3, -95.89,
//     ],
//     first_position_time: '2024-03-11T20:10:46Z',
//     last_position: {
//       fa_flight_id: 'AWI6084-1710016843-schedule-2413p',
//       altitude: 11,
//       altitude_change: '-',
//       groundspeed: 50,
//       heading: 180,
//       latitude: 41.31326,
//       longitude: -95.89459,
//       timestamp: '2024-03-11T21:36:12Z',
//       update_type: 'A',
//     },
//     bounding_box: [41.97643, -95.8949, 41.30003, -87.89524],
//     ident_prefix: null,
//     aircraft_type: 'CRJ2',
//     flightNumber: 'AWI6084',
//     registration: 'N442AW',
//   },
// ];
